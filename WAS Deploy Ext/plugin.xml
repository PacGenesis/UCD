<plugin xmlns="http://www.urbancode.com/PluginXMLSchema_v1"
        xmlns:server="http://www.urbancode.com/PluginServerXMLSchema_v1"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <header>
    <identifier id="com.pacgenesis.was.ext.plugin.WebSphere" version="1" name="WAS - Deploy - Ext"/>
    <description>
This plugin provides extensions to current WebSphere Application Server (WAS - Deploy) plugin
    </description>
    <tag>Application Server/Java/WebSphere/Deployment/Ext</tag>
    <server:required-server-version>6.1.1.2</server:required-server-version>
  </header>
  <step-type name="BuildModuleMap">
    <description>Map a target(server/cluster) to a list of modules of an Enterprise Application.</description>
    <properties>
      <property name="appName" required="true">
        <server:property-ui type="textBox" label="Application Name" description="The name of the application being installed (Used for WebSphere reference)."/>
      </property>
      <property name="appEdition" required="false">
        <server:property-ui type="textBox" label="Application Edition" description="The edition of the application that the target should be mapped to. This will only work for WebSphere VE and WebSphere Application 8.5 and up."/>
      </property>
      <property name="moduleList" required="true">
        <server:property-ui type="textArea" label="Module Names" description="The URIs for the modules. e.g. PlantsByWebSphere.war,WEB-INF/web.xml"/>
      </property>
      <property name="batch">
        <server:property-ui type="checkBox" label="Batch Script" description="Check here if this is part of a batch script. If checked, this command will be added to a batch script to be saved and run later."/>
      </property>
      <property name="scriptFile">
        <server:property-ui type="textBox" label="Script File" description="Name of the script file to be created or appended to." default-value="${p:request.id}.py"/>
      </property>
      <property name="cell">
        <server:property-ui type="textBox" label="Cell Name" default-value="${p?:resource/websphere.cell}" description="The name of the cell to be administered." hidden="true"/>
      </property>
      <property name="node">
        <server:property-ui type="textBox" label="Node Name" default-value="${p?:resource/websphere.node}" description="The name of the node to be administered." hidden="true"/>
      </property>
      <property name="server">
        <server:property-ui type="textBox" label="Server Name" default-value="${p?:resource/websphere.server}" description="The name of the server to be administered." hidden="true"/>
      </property>
      <property name="cluster">
        <server:property-ui type="textBox" label="Cluster Name" default-value="${p?:resource/websphere.cluster}" description="The name of the cluster to be administered." hidden="true"/>
      </property>
      <property name="commandPath">
        <server:property-ui type="textBox" label="Command Path" default-value="${p?:resource/websphere.commandPath}" description="The directory location of the wsadmin command-line executable: e.g., /opt/IBM/WebSphere/AppServer/bin/." hidden="true"/>
      </property>
      <property name="user">
        <server:property-ui type="textBox" label="User Name" default-value="${p?:resource/websphere.user}" description="The user name to be used to connect to the WebSphere Node." hidden="true"/>
      </property>
      <property name="password">
        <server:property-ui type="secureBox" label="Password" default-value="${p?:resource/websphere.password}" description="The password to be used to connect to the WebSphere Node." hidden="true"/>
      </property>
      <property name="host">
        <server:property-ui type="textBox" default-value="${p?:resource/websphere.host}" label="Host" description="Hostname of the server to connect to." hidden="true"/>
      </property>
      <property name="port">
        <server:property-ui type="textBox" default-value="${p?:resource/websphere.port}" label="Port" description="The port to connect to." hidden="true"/>
      </property>
      <property name="connType" required="true">
        <server:property-ui type="selectBox" label="Connection Type" default-value="${p?:resource/websphere.connType}" description="The type of connection to use with wsadmin." hidden="true"/>
        <value label="SOAP">SOAP</value>
        <value label="RMI">RMI</value>
        <value label="NONE">NONE</value>
      </property>
      <property name="additionalArgs">
        <server:property-ui type="textAreaBox" label="Additional CommandLine Arguments" description="New line separated list of additional commandline arguments to pass to wsadmin. These will appended as the last arguments of the command line."/>
      </property>
    </properties>
    <post-processing><![CDATA[
        if (properties.get("exitCode") != 0) {
            properties.put(new java.lang.String("Status"), new java.lang.String("Failure"));
        }
        else {
            properties.put("Status", "Success");
        }
     ]]></post-processing>
    <command program="${GROOVY_HOME}/bin/groovy">
      <arg value="-cp"/>
      <arg path="classes"/>
      <arg file="add_target_to_modules.groovy"/>
      <arg file="${PLUGIN_INPUT_PROPS}"/>
      <arg file="${PLUGIN_OUTPUT_PROPS}"/>
    </command>
  </step-type>
</plugin>